(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.ViUpload=b()})(this,function(){"use strict";function a(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)}function b(b,c){/* istanbul ignore if */if(!a(b,c)){var d=b.className.split(" ");d.push(c),b.className=d.join(" ")}}function c(a){return Object.prototype.toString.call(a).slice(8,-1)}function d(a){var b=void 0,e=c(a);if("Array"===e)b=[];else if("Object"===e)b={};else return a;for(var f in a){var g=a[f],h=c(g);b[f]="Object"===h?d(g):"Array"===h?d(g):g}return b}/**
 *
 * 给target合并key(深度)
 * @export
 * @param {Object} to
 * @param {Object} from
 * @returns
 */function e(a,b){for(var c in b)a[c]&&"object"===j(a[c])?e(a[c],b[c]):a[c]=b[c]}/**
 * 支持多参数的深度克隆
 * 后面的优先级最大
 * @export
 * @param {Object} target
 * @param {Object} rest
 * @returns
 */function f(a){for(var b=arguments.length,c=Array(1<b?b-1:0),f=1;f<b;f++)c[f-1]=arguments[f];for(var g,h=0;h<c.length;h++)g=d(c[h]),e(a,g);return a}function g(a){var b=window.URL||window.webkitURL||window.mozURL;return a&&b?b.createObjectURL(a):""}function h(a,b,c){a.children[0]?a.insertBefore(b,c):a.appendChild(b)}function i(a,b,c){var d=a[b];Object.defineProperty(a,b,{get:function(){return d},set:function(a){d===a||(d=a,"function"==typeof c&&c(a))}})}var j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},k=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},l=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=function(){function a(){k(this,a),this.map={}}return l(a,[{key:"on",value:function(a,b){return this.map[a]?void this.map[a].push(b):void(this.map[a]=[b])}},{key:"emit",value:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];this.map[a].forEach(function(a){a.apply(void 0,c)})}}]),a}();(function(a,b){void 0===b&&(b={});var c=b.insertAt;if(a&&"undefined"!=typeof document){var d=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css","top"===c?d.firstChild?d.insertBefore(e,d.firstChild):d.appendChild(e):d.appendChild(e),e.styleSheet?e.styleSheet.cssText=a:e.appendChild(document.createTextNode(a))}})(".vi-upload-input-wrapper {\n  float: left;\n  overflow: hidden;\n}\n.vi-upload-input-wrapper .vi-upload-input-wrapper-box {\n  position: relative;\n  width: 80px;\n  height: 80px;\n  margin: 0 10px 10px 0;\n  box-sizing: border-box;\n  background-color: #fff;\n  box-shadow: 0 0 6px 2px rgba(0,0,0,0.08);\n  border-radius: 2px;\n}\n.vi-upload-input-wrapper .vi-upload-input-wrapper-box:before {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 20px;\n  height: 2px;\n  background-color: #666;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n}\n.vi-upload-input-wrapper .vi-upload-input-wrapper-box:after {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 20px;\n  height: 2px;\n  background-color: #666;\n  -webkit-transform: translate(-50%, -50%) rotate(90deg);\n          transform: translate(-50%, -50%) rotate(90deg);\n}\n.vi-upload-input-wrapper .vi-upload-input-wrapper-box .vi-upload-input {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  font-size: 0;\n  opacity: 0;\n}\n.vi-upload-file {\n  float: left;\n  margin: 0 10px 10px 0;\n}\n.vi-upload-file .vi-upload-file-box {\n  position: relative;\n  width: 80px;\n  height: 80px;\n  box-sizing: border-box;\n  background-color: #fff;\n  box-shadow: 0 0 6px 2px rgba(0,0,0,0.08);\n  border-radius: 2px;\n  background-size: cover;\n}\n.vi-upload-file .vi-upload-file-box .vi-upload-file-delete {\n  position: absolute;\n  z-index: 2;\n  top: -36px;\n  right: -36px;\n  width: 80px;\n  height: 80px;\n  background: #000;\n  border-radius: 50%;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n}\n.vi-upload-file .vi-upload-file-box .vi-upload-file-delete:before {\n  content: '';\n  position: absolute;\n  width: 6px;\n  height: 45px;\n  top: 50%;\n  left: 50%;\n  border-radius: 6px;\n  background-color: #fff;\n  -webkit-transform: translate(-50%, -50%) rotate(135deg);\n          transform: translate(-50%, -50%) rotate(135deg);\n}\n.vi-upload-file .vi-upload-file-box .vi-upload-file-delete:after {\n  content: '';\n  position: absolute;\n  width: 6px;\n  height: 45px;\n  top: 50%;\n  left: 50%;\n  border-radius: 6px;\n  background-color: #fff;\n  -webkit-transform: translate(-50%, -50%) rotate(-135deg);\n          transform: translate(-50%, -50%) rotate(-135deg);\n}\n");var n={// 容器
el:"",// 上传文件的个数
max:1,// 文件的最大存储
maxSize:0,// 自定义的容器,下版本
slot:{}},o="addFiles",p="changeFiles",q="removeFiles",r=function(){function a(b){k(this,a),this.options=f({},n,b),this.checkType(),this.init()}return l(a,[{key:"init",value:function(){var a=this.initWrapper();a&&(this.initData(),this.listenEvent(),this.watch())}},{key:"checkType",value:function(){/#.+/.test(this.options.el)||console.error("type check failed for options \"el\". please use id selector"),"number"!=typeof this.options.maxSize&&console.error("type check failed for options \"maxSize\"."),"number"!=typeof this.options.max&&console.error("type check failed for options \"max\".")}},{key:"initWrapper",value:function(){var a=this.options.el.slice(1);return(this.el=document.getElementById(a),!this.el)?(console.error("cannot find selector #"+this.el+"."),!1):(this.createInput(),!0)}},{key:"initData",value:function(){this.imgList=[],this.restImgLength=this.options.max}},{key:"listenEvent",value:function(){var a=this;this.ViEvent=new m,this.ViEvent.on(o,function(b){"function"==typeof a.options.events[o]&&a.options.events[o](b)}),this.ViEvent.on(p,function(b){"function"==typeof a.options.events[p]&&a.options.events[p](b)}),this.ViEvent.on(q,function(b){"function"==typeof a.options.events[q]&&a.options.events[q](b)})}},{key:"watch",value:function(){this.watchRestImgLength()}},{key:"watchRestImgLength",value:function(){var a=this;i(this,"restImgLength",function(b){a.inputWrapper.style.display=0<b?"block":"none",a.ViEvent.emit(p,a.imgList)})}},{key:"createInput",value:function(){var a=this;this.inputWrapper=document.createElement("div"),b(this.inputWrapper,"vi-upload-input-wrapper"),this.inputWrapper.innerHTML="<div class=\"vi-upload-input-wrapper-box\">\n                      <input class=\"vi-upload-input\"\n                        type=\"file\"\n                        multiple=\"multiple\"\n                        accept=\"image/*\" />\n                    </div>",this.el.appendChild(this.inputWrapper);var c=this.inputWrapper.getElementsByTagName("input")[0];c.onchange=function(b){for(var c,d=b.currentTarget,e=f({},d),h=e.files,j=[],k=0,l=h[k];j.length<h.length&&l;)c=g(l),j.push(l),l.url=c,l=h[++k];a.ViEvent.emit(o,j),a.createImg(j)}}},{key:"createImg",value:function(a){for(var c=this,d=[],e=0,f=a[e];d.length<this.restImgLength&&f;)d.push(f),f=a[++e];for(var g,k=function(a){var e=d[a];if(e.size>c.options.maxSize)return console.warn("the size of "+a+"th picture exceeds the options maxSize"),"continue";c.imgList.push(e),c.restImgLength=c.options.max-c.imgList.length;var f=document.createElement("div");b(f,"vi-upload-file"),f.innerHTML="<div class=\"vi-upload-file-box\">\n                            <i class=\"vi-upload-file-delete\"></i>\n                          </div>";var g=f.getElementsByClassName("vi-upload-file-box")[0];g.style.backgroundImage="url("+e.url+")",f.appendChild(g),h(c.el,f,c.inputWrapper);var i=f.getElementsByClassName("vi-upload-file-delete")[0];i.onclick=function(b){b.stopPropagation();var d=c.imgList.splice(a,1);c.restImgLength=c.options.max-c.imgList.length,c.el.removeChild(f),c.ViEvent.emit(q,d)}},l=0;l<d.length;l++)g=k(l),"continue"===g}}]),a}();return r});
